# Requirements Archive: v1.0 Codex CLI Support

**Archived:** 2026-02-10
**Status:** SHIPPED

For current requirements, see `.planning/REQUIREMENTS.md`.

---

## Scope

Add OpenAI Codex CLI as a second supported agent in Lanes, enabling users to create, open, resume, and delete Codex-powered sessions through the same sidebar workflow used for Claude Code.

## Requirements

### Foundation (Refactoring)

| ID | Requirement | Priority | Status |
|----|------------|----------|--------|
| REQ-F1 | Eliminate hardcoded Claude assumptions | Critical | [x] Complete — Zero Claude strings outside codeAgents/. All paths use agent methods. |
| REQ-F2 | Agent-agnostic service naming | High | [x] Complete — AgentSessionProvider, AgentSessionData, getAgentStatus. |
| REQ-F3 | Clean abstraction boundary | High | [x] Complete — CodeAgent via DI everywhere. Single factory instantiation point. |

### Agent Abstraction

| ID | Requirement | Priority | Status |
|----|------------|----------|--------|
| REQ-A1 | Agent factory with VS Code setting | Critical | [x] Complete — Factory with hardcoded map, lanes.defaultAgent setting. |
| REQ-A2 | Per-session agent selection | Critical | [x] Complete — agentName in session metadata, dropdown in form. |
| REQ-A3 | Agent-specific session tracking | High | [x] Complete — supportsHooks() distinguishes strategies. Hookless agents get active/idle. |
| REQ-A4 | Format-agnostic settings service | Medium | [x] Complete — SettingsFormatService with JSON and TOML. |

### Codex Integration

| ID | Requirement | Priority | Status |
|----|------------|----------|--------|
| REQ-C1 | CodexCodeAgent implementation | Critical | [x] Complete — Extends CodeAgent, all 17 abstract methods implemented. |
| REQ-C2 | Codex start command building | Critical | [x] Complete — Generates correct codex CLI with sandbox and approval flags. |
| REQ-C3 | Codex resume command building | Critical | [x] Complete — `codex resume <UUID>` with strict validation. |
| REQ-C4 | Codex permission mode mapping | High | [x] Complete — 2 modes: acceptEdits, bypassPermissions with dual-flag system. |
| REQ-C5 | Codex session tracking | High | [x] Complete — Filesystem polling of ~/.codex/sessions/ with 10s timeout. |
| REQ-C6 | Codex terminal identification | Medium | [x] Complete — "Codex: <name>" title, blue robot icon. |

### UI Integration

| ID | Requirement | Priority | Status |
|----|------------|----------|--------|
| REQ-U1 | Agent selector in session form | Critical | [x] Complete — Dropdown defaults to lanes.defaultAgent, hidden when 1 agent. |
| REQ-U2 | Agent-specific permission UI | High | [x] Complete — Permission toggle works for both agents via getPermissionFlag(). |
| REQ-U3 | Terminal differentiation | Medium | [x] Complete — Agent-specific names and icons via CodeAgent methods. |

### Testing

| ID | Requirement | Priority | Status |
|----|------------|----------|--------|
| REQ-T1 | CodexCodeAgent unit tests | Critical | [x] Complete — 26 tests covering commands, permissions, configuration. |
| REQ-T2 | Agent factory tests | High | [x] Complete — 12 tests covering creation, singleton, unknown names, CLI availability. |
| REQ-T3 | Session form agent selection tests | High | [x] Complete — 10 tests covering dropdown, permissions per agent, callback. |
| REQ-T4 | Backward compatibility tests | Critical | [x] Complete — 9 tests for legacy commands, session data, agent coexistence. 705 total passing. |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| REQ-F1 | Phase 1 | Complete |
| REQ-F2 | Phase 1 | Complete |
| REQ-F3 | Phase 1 | Complete |
| REQ-A1 | Phase 2 | Complete |
| REQ-A2 | Phase 2+4 | Complete |
| REQ-A3 | Phase 2 | Complete |
| REQ-A4 | Phase 2 | Complete |
| REQ-C1 | Phase 3 | Complete |
| REQ-C2 | Phase 3 | Complete |
| REQ-C3 | Phase 3 | Complete |
| REQ-C4 | Phase 3 | Complete |
| REQ-C5 | Phase 3 | Complete |
| REQ-C6 | Phase 3 | Complete |
| REQ-U1 | Phase 4 | Complete |
| REQ-U2 | Phase 4 | Complete |
| REQ-U3 | Phase 3+4 | Complete |
| REQ-T1 | Phase 5 | Complete |
| REQ-T2 | Phase 5 | Complete |
| REQ-T3 | Phase 5 | Complete |
| REQ-T4 | Phase 5 | Complete |

**Coverage:** 20/20 requirements shipped (100%)

## Out of Scope

| Item | Rationale | Outcome |
|------|-----------|---------|
| Workflow/MCP support for Codex | Different config mechanism (TOML-based [mcp_servers]) | Deferred — future milestone |
| Codex Cloud integration | Only CLI support needed | Deferred |
| Cross-agent session migration | Unnecessary complexity, different internal formats | Deferred |
| Codex authentication management | Codex handles auth via `codex login` | Deferred |
| Real-time Codex status polling | Start with basic session tracking | Deferred |
| Sidebar visual differentiation | User preference: keep UI clean | Deferred |
| TOML parser dependency | @iarna/toml was added; string generation alone was insufficient | Adjusted — dependency added |

## Dependencies

| Dependency | Type | Outcome |
|------------|------|---------|
| Codex CLI (`@openai/codex`) | Runtime (user) | Detected at activation via execFile |
| VS Code Extension API | Build | No version changes needed |
| Existing CodeAgent abstraction | Internal | Enhanced with 4 new abstract capabilities |
| @iarna/toml | Build (new) | Added for TOML settings format support |

---

## Milestone Summary

**Shipped:** 20 of 20 requirements
**Adjusted:** REQ-C4 (3 permission modes reduced to 2 for simplicity), TOML parser added as dependency (originally out of scope)
**Dropped:** None

---
*Archived: 2026-02-10 as part of v1.0 milestone completion*
