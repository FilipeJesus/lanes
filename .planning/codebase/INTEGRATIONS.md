# External Integrations

**Analysis Date:** 2026-02-10

## APIs & External Services

**Claude Code CLI:**
- Claude Code executable invoked as command-line tool
  - SDK/Client: Direct subprocess spawning (no SDK - invoked as external CLI)
  - Auth: Authenticated via Claude Code's own session management (not handled by Lanes)
  - Purpose: Session management, code agent interface

**Git (Version Control):**
- Git worktree management and diff generation
  - SDK/Client: Command-line execution via `child_process.spawn`
  - Integration point: `src/gitService.ts` with fallback to VS Code Git extension for git path discovery
  - Commands used: `git worktree`, `git rev-parse`, `git show-ref`, `git diff`, `git status`, `git merge-base`, `git fetch`

**VS Code Git Extension:**
- Optional integration for discovering git executable path
  - Extension ID: `vscode.git` (required dependency)
  - API: VS Code Extension API to query git executable location
  - File: `src/gitService.ts` - queries extension during `initializeGitPath()`
  - Fallback: Uses `'git'` from PATH if VS Code Git extension unavailable

**Anthropic Claude (via Claude Code):**
- Indirect integration through Claude Code CLI
  - No direct API calls; Lanes manages sessions which Claude Code uses internally
  - Session tracking via `.claude-session` and `.claude-status` files (read/written by Claude Code)
  - Permission modes configurable: `acceptEdits`, `bypassPermissions`, `dontAsk` (passed to claude CLI)

## Data Storage

**Databases:**
- None. Lanes uses file-based storage only.

**File Storage:**
- Git worktrees (`<repo>/.worktrees/<session-name>/`) - Local filesystem only
- Session state: JSON files in worktrees
  - `workflow-state.json` - MCP server workflow state persistence (one per active workflow)
  - `.claude-session` - Claude Code session metadata (agent-managed)
  - `.claude-status` - Claude Code status file (agent-managed)
  - `claude-settings.json` - Session settings (optional)

**Local Storage Options:**
- Global VS Code Storage: Default location for session tracking (`~/.vscode/` or OS-specific)
  - Controlled by setting: `lanes.useGlobalStorage` (default: true)
  - Fallback: `.lanes/session_management/` at repository root if disabled

**Configuration Files:**
- `.claude/settings.local.json` (base repo) - Propagated to worktrees via:
  - Copy mode (default): File copied to `<worktree>/.claude/settings.local.json`
  - Symlink mode: Symbolic link created (requires developer mode on Windows)
  - Disabled mode: No propagation
  - Controlled by setting: `lanes.localSettingsPropagation`

**Workflow Templates:**
- YAML files stored in custom workflows folder
  - Default location: `.lanes/workflows/` (relative to workspace root)
  - Configurable via setting: `lanes.customWorkflowsFolder`
  - Format: YAML workflow definitions with steps, loops, and task configurations

**Caching:**
- None. All data is persisted to disk; no in-memory caches exposed externally.

## Authentication & Identity

**Auth Provider:**
- None at extension level. Claude Code handles its own authentication via Anthropic API.

**Permission Modes (Claude Code Configuration):**
- Supported modes: `acceptEdits`, `bypassPermissions`, `dontAsk`, `default`
- Configured per-session in start command
- Implementation: `src/codeAgents/ClaudeCodeAgent.ts` builds CLI flags

**Session Identity:**
- UUID-based session IDs generated by Lanes
- Session validation: `src/codeAgents/ClaudeCodeAgent.ts` validates UUIDs before passing to CLI
- Session tracking: Files in worktrees or VS Code global storage

## Monitoring & Observability

**Error Tracking:**
- None. Errors logged to VS Code console/output panel.

**Logs:**
- Console.log() for development debugging
- Output panels for user-facing messages:
  - Terminal output: Claude Code CLI execution captured in dedicated terminal per session
  - VS Code output channel: General extension logging
- Status tracking via `.claude-status` file (agent-managed, read by Lanes for UI display)

**Status Indicators:**
- UI displays Claude Code status: `working`, `waiting_for_user`, `idle`
- Workflow status: `active`, `completed`, `error` (when using MCP workflows)

## CI/CD & Deployment

**Hosting:**
- VS Code Marketplace (primary)
- Open VSX Registry (community alternative)

**CI Pipeline:**
- None detected in codebase
- Manual release process via `scripts/release.sh`
- Pre-commit hook enforces: compile, lint, and test

**Publishing:**
- VS Code: `@vscode/vsce` - Publishes to VS Code Marketplace
- Open VSX: `ovsx` - Publishes to Open VSX registry
- Release commands: `npm run release`, `npm run release:patch/minor/major`

**Versioning:**
- Semantic versioning managed in `package.json`
- Release script: `scripts/release.sh`

## Environment Configuration

**Required env vars:**
- None at extension level. Configuration via VS Code settings JSON.
- Claude Code authentication handled by Claude Code's own environment setup.

**Configuration Settings (VS Code):**
- `lanes.worktreesFolder` - Directory for worktrees (default: `.worktrees`)
- `lanes.baseBranch` - Base branch for diffs (default: auto-detect main/master)
- `lanes.promptsFolder` - Session prompts location (default: global storage)
- `lanes.useGlobalStorage` - Store session tracking in VS Code global storage (default: true)
- `lanes.localSettingsPropagation` - How to propagate settings (default: `copy`)
- `lanes.customWorkflowsFolder` - Custom workflow templates location (default: `.lanes/workflows`)
- `lanes.workflowsEnabled` - Enable workflow selection (default: true)
- `lanes.chimeSound` - Audio notification sound (default: `chime`)

**Secrets location:**
- No secrets stored by Lanes. Claude Code authentication is handled by Claude Code itself.
- No `.env` files used or required.

## Webhooks & Callbacks

**Incoming:**
- Git hooks configured by Lanes:
  - `post-checkout` hook: Updates session tracking when switching branches
  - Hooks managed by: `src/services/SettingsService.ts` - `setupHooks()`
  - Hook script path: `.git/hooks/post-checkout`

**Outgoing:**
- None. Lanes does not make external HTTP requests or webhooks.

**MCP Tools (Workflow Control):**
- Tools exposed to Claude Code via MCP server (`src/mcp/server.ts`):
  - `workflow_start` / `workflow_start_from_path` - Initialize workflow
  - `workflow_set_tasks` - Configure loop tasks
  - `workflow_advance` - Move to next workflow step
  - `workflow_status` - Get current workflow state
  - `workflow_context` - Retrieve output from previous steps
- Transport: Stdio (process pipes) - no network communication

## Worktree Management

**Git Worktree Integration:**
- Creates isolated worktrees from base repository
- Commands: `git worktree add`, `git worktree remove`, `git worktree list`, `git worktree repair`
- Repair logic: `src/services/BrokenWorktreeService.ts` handles broken worktree detection and recovery

**Settings Propagation:**
- Copies or symlinks `.claude/settings.local.json` from base repo to each worktree
- Service: `src/localSettings.ts` - `propagateLocalSettings()`
- Modes: copy (all platforms), symlink (efficient, requires Windows developer mode), disabled

---

*Integration audit: 2026-02-10*
