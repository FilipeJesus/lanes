---
phase: 01-foundation-refactoring
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/ClaudeSessionProvider.ts -> src/AgentSessionProvider.ts (rename)
  - src/extension.ts
  - src/types/serviceContainer.d.ts
  - src/watchers.ts
  - src/services/SettingsService.ts
  - src/services/TerminalService.ts
  - src/services/SessionService.ts
  - src/services/SessionProcessService.ts
  - src/services/BrokenWorktreeService.ts
  - src/commands/sessionCommands.ts
  - src/PreviousSessionProvider.ts
  - src/test/session/session-provider.test.ts
  - src/test/session/session-item.test.ts
  - src/test/session/session-status.test.ts
  - src/test/edgeCases.test.ts
  - src/test/core/extension-settings-hooks.test.ts
  - src/test/core/extension-settings-location.test.ts
  - src/test/core/extension-settings-workflow.test.ts
  - src/test/core/local-settings.test.ts
  - src/test/core/session-provider-workflow.test.ts
  - src/test/core/workflow-summary.test.ts
  - src/test/config/global-storage.test.ts
  - src/test/config/prompts-storage.test.ts
  - src/test/extension-hook-script.test.ts
  - src/test/git/diff-base-branch.test.ts
  - package.json
autonomous: true

must_haves:
  truths:
    - "No class or type named ClaudeSessionProvider, ClaudeStatus, ClaudeStatusState, or ClaudeSessionData exists in shared code"
    - "All services use agent-neutral names: AgentSessionProvider, AgentStatus, AgentStatusState"
    - "Functions getClaudeSessionPath, getClaudeStatusPath, getClaudeStatus, openClaudeTerminal are renamed to agent-neutral equivalents"
    - "Command IDs use lanes.* prefix in package.json"
    - "Backward-compatible aliases exist for all claudeWorktrees.* commands"
    - "View IDs are renamed to lanesSessionsView and lanesSessionFormView"
    - "All imports compile without errors after file rename"
    - "ServiceContainer type references AgentSessionProvider, not ClaudeSessionProvider"
  artifacts:
    - path: "src/AgentSessionProvider.ts"
      provides: "Renamed session provider with agent-neutral names"
      contains: "AgentSessionProvider"
    - path: "package.json"
      provides: "Renamed command IDs and view IDs"
      contains: "lanes.createSession"
    - path: "src/extension.ts"
      provides: "Backward-compatible command aliases and updated registrations"
      contains: "claudeWorktrees.createSession"
    - path: "src/types/serviceContainer.d.ts"
      provides: "Updated type references"
      contains: "AgentSessionProvider"
  key_links:
    - from: "src/extension.ts"
      to: "src/AgentSessionProvider.ts"
      via: "import AgentSessionProvider"
      pattern: "import.*AgentSessionProvider.*from.*AgentSessionProvider"
    - from: "package.json"
      to: "src/extension.ts"
      via: "command IDs lanes.* registered in activate()"
      pattern: "lanes\\.(createSession|openSession|deleteSession)"
    - from: "src/extension.ts"
      to: "backward compatibility aliases"
      via: "claudeWorktrees.* command aliases forwarding to lanes.* implementations"
      pattern: "claudeWorktrees\\."
---

<objective>
Rename all Claude-specific service names, command IDs, and view IDs to agent-neutral equivalents. Establish backward-compatible aliases for command IDs.

Purpose: Complete the agent-agnostic foundation by removing all Claude-specific naming from shared code (REQ-F2) and ensuring clean abstraction boundaries (REQ-F3). After this plan, no shared code references Claude by name except in the `src/codeAgents/` directory.

Output: `AgentSessionProvider.ts` with agent-neutral class/type/function names, `package.json` with `lanes.*` command IDs and renamed view IDs, backward-compatible `claudeWorktrees.*` aliases in `extension.ts`.
</objective>

<execution_context>
@/Users/filipejesus/.claude/get-shit-done/workflows/execute-plan.md
@/Users/filipejesus/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-refactoring/01-CONTEXT.md
@.planning/phases/01-foundation-refactoring/01-01-SUMMARY.md

@src/ClaudeSessionProvider.ts
@src/extension.ts
@src/types/serviceContainer.d.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename file, classes, types, and functions to agent-neutral names</name>
  <files>
    src/ClaudeSessionProvider.ts -> src/AgentSessionProvider.ts (rename)
    src/types/serviceContainer.d.ts
    src/services/SettingsService.ts
    src/services/TerminalService.ts
    src/services/SessionService.ts
    src/services/SessionProcessService.ts
    src/services/BrokenWorktreeService.ts
    src/commands/sessionCommands.ts
    src/PreviousSessionProvider.ts
    src/watchers.ts
    src/extension.ts
  </files>
  <action>
    **Step 1: Rename the file**
    Use `git mv src/ClaudeSessionProvider.ts src/AgentSessionProvider.ts` to rename the file while preserving git history.

    **Step 2: Rename classes, types, and functions inside AgentSessionProvider.ts**
    Apply these renames within the file:
    - `ClaudeStatusState` -> `AgentStatusState`
    - `ClaudeStatus` -> `AgentSessionStatus` (avoid collision with `AgentStatus` from CodeAgent.ts which is a different interface)
    - `ClaudeSessionData` -> `AgentSessionData`
    - `ClaudeSessionProvider` -> `AgentSessionProvider`
    - `getClaudeSessionPath` -> `getSessionFilePath`
    - `getClaudeStatusPath` -> `getStatusFilePath`
    - `getClaudeStatus` -> `getAgentStatus`
    - `getGlobalCodeAgent` -> `getGlobalCodeAgent` (keep — this getter name is already descriptive)
    - `globalCodeAgent` variable -> keep as-is internally (private implementation detail)

    Also rename `VALID_STATUS_VALUES` comment from "Valid Claude status states" to "Valid agent status states".

    **Step 3: Update all imports across the codebase**
    Every file that imports from `'./ClaudeSessionProvider'` or `'../ClaudeSessionProvider'` or `'../../ClaudeSessionProvider'` must be updated to import from `'./AgentSessionProvider'` (or the appropriate relative path) and use the new names.

    Files to update (exhaustive list from research):
    - `src/extension.ts` — update import path and all references
    - `src/watchers.ts` — update import path
    - `src/services/SettingsService.ts` — update import path and references to `getClaudeStatusPath`/`getClaudeSessionPath`
    - `src/services/TerminalService.ts` — update import path and `SessionItem` reference
    - `src/services/SessionService.ts` — update import path and all references (`ClaudeSessionProvider`, `getClaudeStatusPath`, `getClaudeSessionPath`)
    - `src/services/SessionProcessService.ts` — update import path and `ClaudeSessionProvider` reference
    - `src/services/BrokenWorktreeService.ts` — update import path
    - `src/commands/sessionCommands.ts` — update import path and `SessionItem` type reference
    - `src/PreviousSessionProvider.ts` — update import path
    - `src/types/serviceContainer.d.ts` — update import path and type `ClaudeSessionProvider` -> `AgentSessionProvider`

    **Step 4: Rename `openClaudeTerminal` to `openAgentTerminal`**
    In `src/services/TerminalService.ts`:
    - Rename the exported function `openClaudeTerminal` to `openAgentTerminal`
    - Update all references to this function across the codebase:
      - `src/extension.ts`: import and the `openClaudeTerminal` reference (line 49) and call (line 268)
      - `src/services/SessionService.ts`: The `setOpenClaudeTerminal` function and `openClaudeTerminalFn` variable — rename to `setOpenAgentTerminal` and `openAgentTerminalFn`
      - `src/services/SessionProcessService.ts`: import alias `openClaudeTerminalService` -> `openAgentTerminalService`
      - `src/commands/sessionCommands.ts`: import reference

    **Step 5: Rename `setOpenClaudeTerminal` in SessionService.ts**
    - `setOpenClaudeTerminal` -> `setOpenAgentTerminal`
    - `OpenClaudeTerminalFn` type -> `OpenAgentTerminalFn`
    - Update `extension.ts` line 64: `SessionService.setOpenClaudeTerminal` -> `SessionService.setOpenAgentTerminal`

    **Important:** Do NOT change the actual file names used by CodeAgent (`.claude-session`, `.claude-status`) — those are agent-specific and correct. Only rename the TypeScript symbols.
  </action>
  <verify>
    Run: `npm run compile` — must compile with zero errors.

    Run: `grep -r "ClaudeSessionProvider\|ClaudeStatus\|ClaudeSessionData\|ClaudeStatusState\|getClaudeSessionPath\|getClaudeStatusPath\|getClaudeStatus\|openClaudeTerminal\|setOpenClaudeTerminal" src/ --include='*.ts' | grep -v 'src/codeAgents/' | grep -v 'node_modules' | grep -v '\.test\.'`

    Expected: Zero matches in non-test shared code. (Test files are updated in Task 2.)

    Run: `ls src/ClaudeSessionProvider.ts 2>/dev/null` — should not exist (file renamed).
    Run: `ls src/AgentSessionProvider.ts` — should exist.
  </verify>
  <done>
    All Claude-specific class names, type names, and function names in shared production code are renamed to agent-neutral equivalents. The file is renamed from ClaudeSessionProvider.ts to AgentSessionProvider.ts. All imports compile correctly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update command IDs, view IDs, aliases, and test files</name>
  <files>
    package.json
    src/extension.ts
    src/commands/sessionCommands.ts
    src/test/session/session-provider.test.ts
    src/test/session/session-item.test.ts
    src/test/session/session-status.test.ts
    src/test/edgeCases.test.ts
    src/test/core/extension-settings-hooks.test.ts
    src/test/core/extension-settings-location.test.ts
    src/test/core/extension-settings-workflow.test.ts
    src/test/core/local-settings.test.ts
    src/test/core/session-provider-workflow.test.ts
    src/test/core/workflow-summary.test.ts
    src/test/config/global-storage.test.ts
    src/test/config/prompts-storage.test.ts
    src/test/extension-hook-script.test.ts
    src/test/git/diff-base-branch.test.ts
  </files>
  <action>
    **Step 1: Update package.json command IDs**
    Replace all `claudeWorktrees.*` command IDs with `lanes.*` equivalents:
    - `claudeWorktrees.createSession` -> `lanes.createSession`
    - `claudeWorktrees.deleteSession` -> `lanes.deleteSession`
    - `claudeWorktrees.openSession` -> `lanes.openSession`
    - `claudeWorktrees.setupStatusHooks` -> `lanes.setupStatusHooks`
    - `claudeWorktrees.showGitChanges` -> `lanes.showGitChanges`
    - `claudeWorktrees.openInNewWindow` -> `lanes.openInNewWindow`
    - `claudeWorktrees.openPreviousSessionPrompt` -> `lanes.openPreviousSessionPrompt`
    - `claudeWorktrees.enableChime` -> `lanes.enableChime`
    - `claudeWorktrees.disableChime` -> `lanes.disableChime`
    - `claudeWorktrees.testChime` -> `lanes.testChime`
    - `claudeWorktrees.clearSession` -> `lanes.clearSession`
    - `claudeWorktrees.createTerminal` -> `lanes.createTerminal`
    - `claudeWorktrees.searchInWorktree` -> `lanes.searchInWorktree`
    - `claudeWorktrees.openWorkflowState` -> `lanes.openWorkflowState`
    - `claudeWorktrees.playChime` -> `lanes.playChime`

    Also update ALL `when` clauses in `menus` that reference `claudeSessionsView` -> `lanesSessionsView`.

    **Step 2: Update view IDs in package.json**
    - `claudeSessionsView` -> `lanesSessionsView`
    - `claudeSessionFormView` -> `lanesSessionFormView`

    **Step 3: Update SessionFormProvider.viewType**
    Check `src/SessionFormProvider.ts` for `static readonly viewType = 'claudeSessionFormView'` — update to `'lanesSessionFormView'`.

    **Step 4: Update command registrations in sessionCommands.ts**
    Replace all `vscode.commands.registerCommand('claudeWorktrees.*'` with `vscode.commands.registerCommand('lanes.*'`.
    Also update the `item.command` in `SessionItem` constructor (now in AgentSessionProvider.ts) from `'claudeWorktrees.openSession'` to `'lanes.openSession'`.
    Update the `vscode.commands.executeCommand('claudeWorktrees.playChime')` call in SessionItem to `'lanes.playChime'`.

    **Step 5: Register backward-compatible command aliases in extension.ts**
    Per user decision: register old `claudeWorktrees.*` IDs as simple forwarding aliases. Pattern:

    ```typescript
    // Backward-compatible aliases (remove in next release)
    const aliasMap: Record<string, string> = {
        'claudeWorktrees.createSession': 'lanes.createSession',
        'claudeWorktrees.deleteSession': 'lanes.deleteSession',
        'claudeWorktrees.openSession': 'lanes.openSession',
        // ... all 15 commands
    };
    for (const [oldId, newId] of Object.entries(aliasMap)) {
        context.subscriptions.push(
            vscode.commands.registerCommand(oldId, (...args: any[]) =>
                vscode.commands.executeCommand(newId, ...args)
            )
        );
    }
    ```

    Register these AFTER `registerAllCommands()` so the new command IDs exist first.

    **Step 6: Update tree view registration in extension.ts**
    - Line 113: `'claudeSessionsView'` -> `'lanesSessionsView'`

    **Step 7: Update all test files**
    Update imports in ALL test files that reference `ClaudeSessionProvider`:
    - Change import paths from `'../../ClaudeSessionProvider'` to `'../../AgentSessionProvider'`
    - Rename type references: `ClaudeSessionProvider` -> `AgentSessionProvider`, `ClaudeStatus` -> `AgentSessionStatus`, `ClaudeSessionData` -> `AgentSessionData`, `ClaudeStatusState` -> `AgentStatusState`
    - Rename function references: `getClaudeSessionPath` -> `getSessionFilePath`, `getClaudeStatusPath` -> `getStatusFilePath`, `getClaudeStatus` -> `getAgentStatus`
    - Update any `'claudeWorktrees.*'` command string references in tests to `'lanes.*'`
    - Update any `'claudeSessionsView'` references in tests to `'lanesSessionsView'`

    Test files to update (exhaustive list):
    - `src/test/session/session-provider.test.ts`
    - `src/test/session/session-item.test.ts`
    - `src/test/session/session-status.test.ts`
    - `src/test/edgeCases.test.ts`
    - `src/test/core/extension-settings-hooks.test.ts`
    - `src/test/core/extension-settings-location.test.ts`
    - `src/test/core/extension-settings-workflow.test.ts`
    - `src/test/core/local-settings.test.ts`
    - `src/test/core/session-provider-workflow.test.ts`
    - `src/test/core/workflow-summary.test.ts`
    - `src/test/config/global-storage.test.ts`
    - `src/test/config/prompts-storage.test.ts`
    - `src/test/extension-hook-script.test.ts`
    - `src/test/git/diff-base-branch.test.ts`
  </action>
  <verify>
    Run: `npm run compile` — must compile cleanly.

    Run: `npm run lint` — must pass.

    Run: `npm test` — all tests must pass.

    Run: `grep -r "claudeWorktrees\." package.json` — should find ZERO matches (all replaced with lanes.*).

    Run: `grep -r "lanes\." package.json | head -20` — should show the new command IDs.

    Run: `grep -r "claudeSessionsView\|claudeSessionFormView" package.json` — should find ZERO matches.

    Run: `grep -r "ClaudeSessionProvider\|ClaudeStatus\b\|ClaudeSessionData\|ClaudeStatusState\|getClaudeSessionPath\|getClaudeStatusPath\|getClaudeStatus\b\|openClaudeTerminal\|setOpenClaudeTerminal" src/ --include='*.ts' | grep -v 'src/codeAgents/'` — should find ZERO matches (all renamed).
  </verify>
  <done>
    All command IDs use `lanes.*` prefix. View IDs are `lanesSessionsView` and `lanesSessionFormView`. Backward-compatible aliases for `claudeWorktrees.*` are registered. All classes, types, and functions use agent-neutral names. All test files updated and passing. REQ-F2 and REQ-F3 are satisfied.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **No Claude-specific names in shared code:**
   ```bash
   grep -r "ClaudeSessionProvider\|ClaudeStatus\b\|ClaudeSessionData\|ClaudeStatusState\|getClaudeSessionPath\|getClaudeStatusPath\|getClaudeStatus\b\|openClaudeTerminal\|setOpenClaudeTerminal" src/ --include='*.ts' | grep -v 'src/codeAgents/'
   ```
   Expected: Zero matches.

2. **No old command IDs in package.json:**
   ```bash
   grep "claudeWorktrees\." package.json
   ```
   Expected: Zero matches.

3. **No old view IDs in package.json:**
   ```bash
   grep "claudeSessionsView\|claudeSessionFormView" package.json
   ```
   Expected: Zero matches.

4. **Backward-compatible aliases registered:**
   ```bash
   grep "claudeWorktrees" src/extension.ts
   ```
   Expected: Alias registration block found.

5. **Full test suite passes:**
   ```bash
   npm test
   ```
   Expected: All tests pass.

6. **Pre-commit checks pass:**
   ```bash
   npm run compile && npm run lint && npm test
   ```
   Expected: All pass.
</verification>

<success_criteria>
- File renamed: ClaudeSessionProvider.ts -> AgentSessionProvider.ts
- All Claude-specific class/type/function names replaced with agent-neutral names
- Command IDs use lanes.* prefix with backward-compatible claudeWorktrees.* aliases
- View IDs renamed to lanesSessionsView and lanesSessionFormView
- ServiceContainer references AgentSessionProvider
- All imports updated across entire codebase
- All tests pass
- REQ-F2 (agent-agnostic service naming) satisfied
- REQ-F3 (clean abstraction boundary) satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-refactoring/01-02-SUMMARY.md`
</output>
