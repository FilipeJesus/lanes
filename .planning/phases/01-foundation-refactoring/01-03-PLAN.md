---
phase: 01-foundation-refactoring
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - src/ClaudeSessionProvider.ts -> src/AgentSessionProvider.ts (rename)
  - src/types/serviceContainer.d.ts
  - src/services/SettingsService.ts
  - src/services/TerminalService.ts
  - src/services/SessionService.ts
  - src/services/SessionProcessService.ts
  - src/services/BrokenWorktreeService.ts
  - src/commands/sessionCommands.ts
  - src/PreviousSessionProvider.ts
  - src/watchers.ts
  - src/extension.ts
autonomous: true

must_haves:
  truths:
    - "No class, type, or function named ClaudeSessionProvider, ClaudeStatus, ClaudeSessionData, ClaudeStatusState, getClaudeSessionPath, getClaudeStatusPath, getClaudeStatus, openClaudeTerminal, or setOpenClaudeTerminal exists in production code outside src/codeAgents/"
    - "All production imports resolve to AgentSessionProvider.ts (the old ClaudeSessionProvider.ts file no longer exists)"
    - "Project compiles with zero errors after all renames"
  artifacts:
    - path: "src/AgentSessionProvider.ts"
      provides: "Renamed session provider with agent-neutral class/type/function names"
      contains: "AgentSessionProvider"
    - path: "src/types/serviceContainer.d.ts"
      provides: "Updated type references"
      contains: "AgentSessionProvider"
  key_links:
    - from: "src/extension.ts"
      to: "src/AgentSessionProvider.ts"
      via: "import AgentSessionProvider"
      pattern: "import.*AgentSessionProvider.*from.*AgentSessionProvider"
    - from: "src/services/SettingsService.ts"
      to: "src/AgentSessionProvider.ts"
      via: "import getStatusFilePath, getSessionFilePath"
      pattern: "from.*AgentSessionProvider"
    - from: "src/services/SessionService.ts"
      to: "src/AgentSessionProvider.ts"
      via: "import AgentSessionProvider and renamed functions"
      pattern: "from.*AgentSessionProvider"
---

<objective>
Rename ClaudeSessionProvider.ts to AgentSessionProvider.ts and rename all Claude-specific class names, type names, and function names to agent-neutral equivalents across all production code.

Purpose: Complete REQ-F2 (agent-agnostic service naming) for production code. After this plan, no Claude-specific TypeScript symbols exist in production code outside src/codeAgents/.

Output: AgentSessionProvider.ts with all agent-neutral names, all production imports updated and compiling.
</objective>

<execution_context>
@/Users/filipejesus/.claude/get-shit-done/workflows/execute-plan.md
@/Users/filipejesus/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-refactoring/01-CONTEXT.md
@.planning/phases/01-foundation-refactoring/01-02-SUMMARY.md

@src/ClaudeSessionProvider.ts
@src/extension.ts
@src/types/serviceContainer.d.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename symbols inside file, update all production imports, then git mv</name>
  <files>
    src/ClaudeSessionProvider.ts -> src/AgentSessionProvider.ts (rename)
    src/types/serviceContainer.d.ts
    src/services/SettingsService.ts
    src/services/TerminalService.ts
    src/services/SessionService.ts
    src/services/SessionProcessService.ts
    src/services/BrokenWorktreeService.ts
    src/commands/sessionCommands.ts
    src/PreviousSessionProvider.ts
    src/watchers.ts
    src/extension.ts
  </files>
  <action>
    **IMPORTANT: Ordering matters to avoid breaking compilation between steps.**

    **Step 1: Rename symbols inside ClaudeSessionProvider.ts (while file still has old name)**
    Apply these renames within the file:
    - `ClaudeStatusState` -> `AgentStatusState`
    - `ClaudeStatus` -> `AgentSessionStatus` (avoid collision with `AgentStatus` from CodeAgent.ts which is a different interface)
    - `ClaudeSessionData` -> `AgentSessionData`
    - `ClaudeSessionProvider` -> `AgentSessionProvider`
    - `getClaudeSessionPath` -> `getSessionFilePath`
    - `getClaudeStatusPath` -> `getStatusFilePath`
    - `getClaudeStatus` -> `getAgentStatus`
    - `getGlobalCodeAgent` -> `getGlobalCodeAgent` (keep -- already descriptive)
    - `globalCodeAgent` variable -> keep as-is internally (private detail)
    - Rename `VALID_STATUS_VALUES` comment from "Valid Claude status states" to "Valid agent status states".

    **Step 2: Update all imports and references in consuming production files**
    Every file that imports from `'./ClaudeSessionProvider'` or `'../ClaudeSessionProvider'` or `'../../ClaudeSessionProvider'` must be updated to import from `'./AgentSessionProvider'` (or the appropriate relative path) and use the new names.

    Files to update (exhaustive list):
    - `src/extension.ts` -- update import path and all symbol references
    - `src/watchers.ts` -- update import path and symbol references
    - `src/services/SettingsService.ts` -- update import path and references to `getClaudeStatusPath`/`getClaudeSessionPath` -> `getStatusFilePath`/`getSessionFilePath`
    - `src/services/TerminalService.ts` -- update import path
    - `src/services/SessionService.ts` -- update import path and all symbol references
    - `src/services/SessionProcessService.ts` -- update import path and `ClaudeSessionProvider` reference
    - `src/services/BrokenWorktreeService.ts` -- update import path
    - `src/commands/sessionCommands.ts` -- update import path
    - `src/PreviousSessionProvider.ts` -- update import path
    - `src/types/serviceContainer.d.ts` -- update import path and type `ClaudeSessionProvider` -> `AgentSessionProvider`

    **Step 3: Rename `openClaudeTerminal` to `openAgentTerminal`**
    In `src/services/TerminalService.ts`:
    - Rename the exported function `openClaudeTerminal` to `openAgentTerminal`
    - Update all references across the codebase:
      - `src/extension.ts`: import and function reference
      - `src/services/SessionService.ts`: `setOpenClaudeTerminal`/`openClaudeTerminalFn` -> `setOpenAgentTerminal`/`openAgentTerminalFn`, `OpenClaudeTerminalFn` type -> `OpenAgentTerminalFn`
      - `src/services/SessionProcessService.ts`: import alias
      - `src/commands/sessionCommands.ts`: import reference

    **Step 4: git mv the file LAST**
    Use `git mv src/ClaudeSessionProvider.ts src/AgentSessionProvider.ts` to rename the file while preserving git history. This MUST be the last step -- all imports already point to the new path.

    **Step 5: Verify compilation**
    Run `npm run compile` to confirm everything links correctly.

    **Important:** Do NOT update test files -- that is Plan 01-04's scope. Tests may fail to compile until 01-04 runs. Do NOT change command IDs or view IDs -- that is also Plan 01-04.
  </action>
  <verify>
    Run: `npm run compile` -- must compile with zero errors (excluding test files if they fail due to old imports -- the `tsconfig` may or may not include tests in compilation).

    Run:
    ```bash
    grep -r "ClaudeSessionProvider\|ClaudeStatus\b\|ClaudeSessionData\|ClaudeStatusState\|getClaudeSessionPath\|getClaudeStatusPath\|getClaudeStatus\b\|openClaudeTerminal\|setOpenClaudeTerminal" src/ --include='*.ts' | grep -v 'src/codeAgents/' | grep -v 'node_modules' | grep -v '\.test\.'
    ```
    Expected: Zero matches in non-test production code.

    Run: `ls src/ClaudeSessionProvider.ts 2>/dev/null` -- should not exist.
    Run: `ls src/AgentSessionProvider.ts` -- should exist.
  </verify>
  <done>
    All Claude-specific class names, type names, and function names in shared production code are renamed to agent-neutral equivalents. The file is renamed from ClaudeSessionProvider.ts to AgentSessionProvider.ts. All production imports compile correctly. Test files are NOT yet updated (Plan 01-04).
  </done>
</task>

</tasks>

<verification>
After task completes:

1. **No Claude-specific names in production code:**
   ```bash
   grep -r "ClaudeSessionProvider\|ClaudeStatus\b\|ClaudeSessionData\|ClaudeStatusState\|getClaudeSessionPath\|getClaudeStatusPath\|getClaudeStatus\b\|openClaudeTerminal\|setOpenClaudeTerminal" src/ --include='*.ts' | grep -v 'src/codeAgents/' | grep -v '\.test\.'
   ```
   Expected: Zero matches.

2. **File renamed:**
   ```bash
   ls src/AgentSessionProvider.ts && ! ls src/ClaudeSessionProvider.ts 2>/dev/null
   ```
   Expected: AgentSessionProvider.ts exists, ClaudeSessionProvider.ts does not.

3. **Production compilation clean:**
   ```bash
   npm run compile
   ```
   Expected: No errors.
</verification>

<success_criteria>
- File renamed: ClaudeSessionProvider.ts -> AgentSessionProvider.ts
- All Claude-specific TypeScript symbols replaced with agent-neutral names in production code
- openClaudeTerminal renamed to openAgentTerminal throughout production code
- ServiceContainer type references AgentSessionProvider
- All production imports updated and compiling
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-refactoring/01-03-SUMMARY.md`
</output>
