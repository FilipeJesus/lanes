---
phase: 01-foundation-refactoring
plan: 04
type: execute
wave: 4
depends_on: ["01-03"]
files_modified:
  - package.json
  - src/extension.ts
  - src/commands/sessionCommands.ts
  - src/SessionFormProvider.ts
  - src/AgentSessionProvider.ts
  - src/test/session/session-provider.test.ts
  - src/test/session/session-item.test.ts
  - src/test/session/session-status.test.ts
  - src/test/edgeCases.test.ts
  - src/test/core/extension-settings-hooks.test.ts
  - src/test/core/extension-settings-location.test.ts
  - src/test/core/extension-settings-workflow.test.ts
  - src/test/core/local-settings.test.ts
  - src/test/core/session-provider-workflow.test.ts
  - src/test/core/workflow-summary.test.ts
  - src/test/config/global-storage.test.ts
  - src/test/config/prompts-storage.test.ts
  - src/test/extension-hook-script.test.ts
  - src/test/git/diff-base-branch.test.ts
autonomous: true

must_haves:
  truths:
    - "Commands in VS Code use lanes.* prefix (users see 'Lanes: Create Session' not 'Claude Worktrees: Create Session')"
    - "Existing keybindings and menu items that used claudeWorktrees.* still work via backward-compatible aliases"
    - "Sidebar tree view IDs are lanesSessionsView and lanesSessionFormView"
    - "All tests pass with no Claude-specific symbols remaining anywhere in the codebase outside src/codeAgents/"
  artifacts:
    - path: "package.json"
      provides: "Renamed command IDs and view IDs"
      contains: "lanes.createSession"
    - path: "src/extension.ts"
      provides: "Backward-compatible command aliases"
      contains: "claudeWorktrees.createSession"
  key_links:
    - from: "package.json"
      to: "src/extension.ts"
      via: "command IDs lanes.* registered in activate()"
      pattern: "lanes\\.(createSession|openSession|deleteSession)"
    - from: "src/extension.ts"
      to: "backward compatibility"
      via: "claudeWorktrees.* command aliases forwarding to lanes.* implementations"
      pattern: "claudeWorktrees\\."
---

<objective>
Update command IDs, view IDs, and test files to complete the agent-agnostic rename. Register backward-compatible command aliases.

Purpose: Finalize REQ-F2 (agent-agnostic naming) and REQ-F3 (clean abstraction boundary) across the entire codebase including tests. After this plan, no Claude-specific references exist outside src/codeAgents/.

Output: package.json with lanes.* commands, backward-compatible aliases in extension.ts, all test files updated and passing.
</objective>

<execution_context>
@/Users/filipejesus/.claude/get-shit-done/workflows/execute-plan.md
@/Users/filipejesus/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-refactoring/01-CONTEXT.md
@.planning/phases/01-foundation-refactoring/01-03-SUMMARY.md

@package.json
@src/extension.ts
@src/commands/sessionCommands.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update command IDs, view IDs, and register backward-compatible aliases</name>
  <files>
    package.json
    src/extension.ts
    src/commands/sessionCommands.ts
    src/SessionFormProvider.ts
    src/AgentSessionProvider.ts
  </files>
  <action>
    **Step 1: Update package.json command IDs**
    Replace all `claudeWorktrees.*` command IDs with `lanes.*` equivalents:
    - `claudeWorktrees.createSession` -> `lanes.createSession`
    - `claudeWorktrees.deleteSession` -> `lanes.deleteSession`
    - `claudeWorktrees.openSession` -> `lanes.openSession`
    - `claudeWorktrees.setupStatusHooks` -> `lanes.setupStatusHooks`
    - `claudeWorktrees.showGitChanges` -> `lanes.showGitChanges`
    - `claudeWorktrees.openInNewWindow` -> `lanes.openInNewWindow`
    - `claudeWorktrees.openPreviousSessionPrompt` -> `lanes.openPreviousSessionPrompt`
    - `claudeWorktrees.enableChime` -> `lanes.enableChime`
    - `claudeWorktrees.disableChime` -> `lanes.disableChime`
    - `claudeWorktrees.testChime` -> `lanes.testChime`
    - `claudeWorktrees.clearSession` -> `lanes.clearSession`
    - `claudeWorktrees.createTerminal` -> `lanes.createTerminal`
    - `claudeWorktrees.searchInWorktree` -> `lanes.searchInWorktree`
    - `claudeWorktrees.openWorkflowState` -> `lanes.openWorkflowState`
    - `claudeWorktrees.playChime` -> `lanes.playChime`

    Also update ALL `when` clauses in `menus` that reference view IDs (see Step 2).

    **Step 2: Update view IDs in package.json**
    - `claudeSessionsView` -> `lanesSessionsView`
    - `claudeSessionFormView` -> `lanesSessionFormView`

    Update every occurrence in `views`, `menus`, and `when` clauses.

    **Step 3: Update view type constants in source**
    - `src/SessionFormProvider.ts`: Update `static readonly viewType = 'claudeSessionFormView'` to `'lanesSessionFormView'`.
    - `src/AgentSessionProvider.ts` (if it has a `SessionItem` that references `'claudeWorktrees.openSession'` as command.command): Update to `'lanes.openSession'`.
    - Also update any `vscode.commands.executeCommand('claudeWorktrees.playChime')` calls to `'lanes.playChime'`.

    **Step 4: Update command registrations in sessionCommands.ts**
    Replace all `vscode.commands.registerCommand('claudeWorktrees.*'` with `vscode.commands.registerCommand('lanes.*'`.

    **Step 5: Register backward-compatible command aliases in extension.ts**
    Per user decision: register old `claudeWorktrees.*` IDs as simple forwarding aliases. Pattern:

    ```typescript
    // Backward-compatible aliases (remove in next release)
    const aliasMap: Record<string, string> = {
        'claudeWorktrees.createSession': 'lanes.createSession',
        'claudeWorktrees.deleteSession': 'lanes.deleteSession',
        'claudeWorktrees.openSession': 'lanes.openSession',
        'claudeWorktrees.setupStatusHooks': 'lanes.setupStatusHooks',
        'claudeWorktrees.showGitChanges': 'lanes.showGitChanges',
        'claudeWorktrees.openInNewWindow': 'lanes.openInNewWindow',
        'claudeWorktrees.openPreviousSessionPrompt': 'lanes.openPreviousSessionPrompt',
        'claudeWorktrees.enableChime': 'lanes.enableChime',
        'claudeWorktrees.disableChime': 'lanes.disableChime',
        'claudeWorktrees.testChime': 'lanes.testChime',
        'claudeWorktrees.clearSession': 'lanes.clearSession',
        'claudeWorktrees.createTerminal': 'lanes.createTerminal',
        'claudeWorktrees.searchInWorktree': 'lanes.searchInWorktree',
        'claudeWorktrees.openWorkflowState': 'lanes.openWorkflowState',
        'claudeWorktrees.playChime': 'lanes.playChime',
    };
    for (const [oldId, newId] of Object.entries(aliasMap)) {
        context.subscriptions.push(
            vscode.commands.registerCommand(oldId, (...args: any[]) =>
                vscode.commands.executeCommand(newId, ...args)
            )
        );
    }
    ```

    Register these AFTER `registerAllCommands()` so the new command IDs exist first.

    **Step 6: Update tree view registration in extension.ts**
    - `'claudeSessionsView'` -> `'lanesSessionsView'`
  </action>
  <verify>
    Run: `npm run compile` -- must compile cleanly.

    ```bash
    grep -r "claudeWorktrees\." package.json
    ```
    Expected: Zero matches.

    ```bash
    grep -r "claudeSessionsView\|claudeSessionFormView" package.json src/ --include='*.ts' | grep -v '\.test\.'
    ```
    Expected: Zero matches (old view IDs completely replaced in production code).

    ```bash
    grep "lanes\." package.json | head -20
    ```
    Expected: New command IDs visible.

    ```bash
    grep "claudeWorktrees" src/extension.ts
    ```
    Expected: Only found in the backward-compatible alias block.
  </verify>
  <done>
    All command IDs use lanes.* prefix. View IDs are lanesSessionsView and lanesSessionFormView. Backward-compatible aliases for claudeWorktrees.* are registered. Production code compiles.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update all test files for renamed symbols and command IDs</name>
  <files>
    src/test/session/session-provider.test.ts
    src/test/session/session-item.test.ts
    src/test/session/session-status.test.ts
    src/test/edgeCases.test.ts
    src/test/core/extension-settings-hooks.test.ts
    src/test/core/extension-settings-location.test.ts
    src/test/core/extension-settings-workflow.test.ts
    src/test/core/local-settings.test.ts
    src/test/core/session-provider-workflow.test.ts
    src/test/core/workflow-summary.test.ts
    src/test/config/global-storage.test.ts
    src/test/config/prompts-storage.test.ts
    src/test/extension-hook-script.test.ts
    src/test/git/diff-base-branch.test.ts
  </files>
  <action>
    This is a mechanical find-replace across all test files. For each test file:

    **Import path updates:**
    - `'../../ClaudeSessionProvider'` -> `'../../AgentSessionProvider'`
    - `'../ClaudeSessionProvider'` -> `'../AgentSessionProvider'`
    - Any other relative path variant pointing to the old file

    **Type/class renames:**
    - `ClaudeSessionProvider` -> `AgentSessionProvider`
    - `ClaudeStatus` -> `AgentSessionStatus`
    - `ClaudeSessionData` -> `AgentSessionData`
    - `ClaudeStatusState` -> `AgentStatusState`

    **Function renames:**
    - `getClaudeSessionPath` -> `getSessionFilePath`
    - `getClaudeStatusPath` -> `getStatusFilePath`
    - `getClaudeStatus` -> `getAgentStatus`
    - `openClaudeTerminal` -> `openAgentTerminal`
    - `setOpenClaudeTerminal` -> `setOpenAgentTerminal`
    - `OpenClaudeTerminalFn` -> `OpenAgentTerminalFn`

    **Command ID updates in tests:**
    - `'claudeWorktrees.*'` -> `'lanes.*'` for all command string references
    - `'claudeSessionsView'` -> `'lanesSessionsView'`
    - `'claudeSessionFormView'` -> `'lanesSessionFormView'`

    **Strategy:** Process each file systematically. Open, apply all renames, save. The changes are purely mechanical -- no logic changes, only symbol names and import paths.

    Test files to update (exhaustive list):
    - `src/test/session/session-provider.test.ts`
    - `src/test/session/session-item.test.ts`
    - `src/test/session/session-status.test.ts`
    - `src/test/edgeCases.test.ts`
    - `src/test/core/extension-settings-hooks.test.ts`
    - `src/test/core/extension-settings-location.test.ts`
    - `src/test/core/extension-settings-workflow.test.ts`
    - `src/test/core/local-settings.test.ts`
    - `src/test/core/session-provider-workflow.test.ts`
    - `src/test/core/workflow-summary.test.ts`
    - `src/test/config/global-storage.test.ts`
    - `src/test/config/prompts-storage.test.ts`
    - `src/test/extension-hook-script.test.ts`
    - `src/test/git/diff-base-branch.test.ts`
  </action>
  <verify>
    Run: `npm run compile` -- must compile cleanly.

    Run: `npm run lint` -- must pass.

    Run: `npm test` -- all tests must pass.

    Run:
    ```bash
    grep -r "ClaudeSessionProvider\|ClaudeStatus\b\|ClaudeSessionData\|ClaudeStatusState\|getClaudeSessionPath\|getClaudeStatusPath\|getClaudeStatus\b\|openClaudeTerminal\|setOpenClaudeTerminal" src/ --include='*.ts' | grep -v 'src/codeAgents/'
    ```
    Expected: Zero matches -- no Claude-specific symbols remain anywhere outside codeAgents.

    Run:
    ```bash
    grep -r "claudeWorktrees\." src/ --include='*.test.ts'
    ```
    Expected: Zero matches in test files (command IDs all updated to lanes.*).
  </verify>
  <done>
    All test files updated with agent-neutral imports, type names, function names, and command IDs. Full test suite passes. No Claude-specific symbols remain anywhere in the codebase outside src/codeAgents/. REQ-F2 and REQ-F3 fully satisfied.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **No old command IDs in package.json:**
   ```bash
   grep "claudeWorktrees\." package.json
   ```
   Expected: Zero matches.

2. **No old view IDs in package.json:**
   ```bash
   grep "claudeSessionsView\|claudeSessionFormView" package.json
   ```
   Expected: Zero matches.

3. **Backward-compatible aliases registered:**
   ```bash
   grep "claudeWorktrees" src/extension.ts
   ```
   Expected: Only the alias registration block.

4. **No Claude symbols anywhere outside codeAgents:**
   ```bash
   grep -r "ClaudeSessionProvider\|ClaudeStatus\b\|ClaudeSessionData\|ClaudeStatusState\|getClaudeSessionPath\|getClaudeStatusPath\|getClaudeStatus\b\|openClaudeTerminal\|setOpenClaudeTerminal" src/ --include='*.ts' | grep -v 'src/codeAgents/'
   ```
   Expected: Zero matches.

5. **Full pre-commit suite passes:**
   ```bash
   npm run compile && npm run lint && npm test
   ```
   Expected: All pass.
</verification>

<success_criteria>
- Command IDs use lanes.* prefix with backward-compatible claudeWorktrees.* aliases
- View IDs renamed to lanesSessionsView and lanesSessionFormView
- All test files updated with agent-neutral names
- All tests pass
- REQ-F2 (agent-agnostic service naming) fully satisfied
- REQ-F3 (clean abstraction boundary) fully satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-refactoring/01-04-SUMMARY.md`
</output>
