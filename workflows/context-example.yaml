# =============================================================================
# WORKFLOW TEMPLATE: Context Example (Demonstrates Context Management)
# =============================================================================
#
# This is a TEMPLATE file for reference. Built-in workflows are not selectable
# in the workflow dropdown - only custom workflows appear there.
#
# TO USE THIS TEMPLATE:
# ---------------------
# 1. Copy this file to your project's .lanes/workflows/ directory
# 2. Customize the workflow for your project's needs
# 3. The workflow will appear in the "Custom" section of the dropdown
#
# CONTEXT MANAGEMENT
# ------------------
# This workflow demonstrates how to use the context management feature.
# The context field can be set to:
#   - restart: Restarts the session with fresh context (no conversation history)
#   - clear: Clears the conversation history before the step
#   - compact: Compacts the conversation history before the step
#   - omitted: No context action (default behavior)
#
# Use context: restart for steps that benefit from a completely fresh session:
#   - Starting a new phase of work with no conversation history
#   - Brainstorming new ideas with maximum context refresh
#   - Analyzing problems from first principles
#
# Use context: clear for steps that benefit from a fresh start:
#   - Brainstorming new ideas
#   - Analyzing problems from first principles
#   - Starting a new phase of work
#
# Use context: compact for steps that need focused context, like:
#   - Writing code (reduces token usage while keeping relevant info)
#   - Detailed implementation work
#   - Reviewing accumulated work
#
# =============================================================================
# REQUIRED vs OPTIONAL FIELDS
# ---------------------------
# Required:
#   - name: Unique identifier for the workflow
#   - description: Brief description of purpose
#   - steps: The main workflow sequence
#
# Optional:
#   - agents: Only needed for complex workflows with specialized sub-agents
#   - loops: Only needed for workflows that iterate over multiple tasks
#
# Simple workflows can omit agents and loops. When omitted, the main Claude
# agent handles all steps directly.
#
# =============================================================================

name: context-example
description: Example workflow demonstrating context management features

loops:
  implement_loop:
    - id: analyze
      instructions: |
        Analyze the requirements for: {task.title}

        1. Read relevant files to understand context
        2. Identify edge cases and constraints
        3. Plan the implementation approach

    - id: code
      context: compact
      instructions: |
        Write the implementation code for: {task.title}

        Context is compacted before coding to focus on current task
        and reduce token usage while keeping relevant information.

        1. Write the code
        2. Verify it compiles
        3. Add necessary comments

    - id: verify
      instructions: |
        Verify the implementation of: {task.title}

        1. Run tests
        2. Check for edge cases
        3. Ensure requirements are met

steps:
  - id: brainstorm
    type: action
    context: restart
    instructions: |
      Start with a completely fresh session.

      This step restarts the Claude session with no conversation history.
      The workflow state is preserved and will be restored.

      1. Consider the problem from first principles
      2. Generate multiple solution approaches
      3. Evaluate pros and cons of each

  - id: plan
    type: action
    instructions: |
      Create a detailed plan based on the brainstorming.

      No context action - this step uses the accumulated context
      from the brainstorming phase to build a structured plan.

      1. Organize ideas into a coherent strategy
      2. Define specific tasks
      3. Identify dependencies

  - id: implement_loop
    type: loop

  - id: review
    type: action
    context: compact
    instructions: |
      Review the implementation.

      This step compacts the conversation before review to focus
      on the completed work while maintaining essential context.

      1. Verify all requirements are met
      2. Check code quality
      3. Identify any improvements needed
