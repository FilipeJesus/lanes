                        <section id="workflow-structure" class="doc-section mb-16 scroll-mt-24 hidden">
                            <div class="bg-surface-0 rounded-xl border border-border p-6 sm:p-8">
                                <div class="flex items-center gap-4 mb-6">
                                    <div class="w-12 h-12 rounded-lg bg-accent/10 flex items-center justify-center">
                                        <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"></path></svg>
                                    </div>
                                    <h2 class="text-3xl font-bold text-ink">Workflow Structure</h2>
                                </div>
                                <p class="text-ink-muted mb-6">
                                    This section covers the YAML structure of workflow templates, including how to define agents, create loops, and configure steps.
                                </p>

                                <div class="space-y-10">
                                    <!-- YAML Structure Overview -->
                                    <div>
                                        <h3 class="text-2xl font-bold text-ink mb-4">YAML Structure Overview</h3>
                                        <p class="text-ink-muted mb-4">
                                            Workflow templates are YAML files. Simple workflows only need <code class="text-xs bg-surface-2 px-1.5 py-0.5 rounded font-mono text-ink-muted">name</code>, <code class="text-xs bg-surface-2 px-1.5 py-0.5 rounded font-mono text-ink-muted">description</code>, and <code class="text-xs bg-surface-2 px-1.5 py-0.5 rounded font-mono text-ink-muted">steps</code>. The <code class="text-xs bg-surface-2 px-1.5 py-0.5 rounded font-mono text-ink-muted">agents</code> and <code class="text-xs bg-surface-2 px-1.5 py-0.5 rounded font-mono text-ink-muted">loops</code> sections are optional for more complex workflows:
                                        </p>

                                        <div class="space-y-4">
                                            <div class="bg-surface-2 rounded-lg p-4">
                                                <h4 class="font-bold text-ink mb-2 font-mono text-sm">name</h4>
                                                <p class="text-sm text-ink-muted">
                                                    <strong>Type:</strong> string<br>
                                                    <strong>Required:</strong> Yes<br>
                                                    <strong>Purpose:</strong> Identifies the workflow. Must be unique within your project.
                                                </p>
                                            </div>

                                            <div class="bg-surface-2 rounded-lg p-4">
                                                <h4 class="font-bold text-ink mb-2 font-mono text-sm">description</h4>
                                                <p class="text-sm text-ink-muted">
                                                    <strong>Type:</strong> string<br>
                                                    <strong>Required:</strong> Yes<br>
                                                    <strong>Purpose:</strong> Human-readable description shown in the workflow selector.
                                                </p>
                                            </div>

                                            <div class="bg-surface-2 rounded-lg p-4">
                                                <h4 class="font-bold text-ink mb-2 font-mono text-sm">agents</h4>
                                                <p class="text-sm text-ink-muted">
                                                    <strong>Type:</strong> object<br>
                                                    <strong>Required:</strong> No (optional)<br>
                                                    <strong>Purpose:</strong> Defines specialized agents with tool permissions and restrictions. Only needed for complex workflows requiring sub-agents.
                                                </p>
                                            </div>

                                            <div class="bg-surface-2 rounded-lg p-4">
                                                <h4 class="font-bold text-ink mb-2 font-mono text-sm">loops</h4>
                                                <p class="text-sm text-ink-muted">
                                                    <strong>Type:</strong> object<br>
                                                    <strong>Required:</strong> No (optional)<br>
                                                    <strong>Purpose:</strong> Reusable sub-workflows that iterate over tasks. Only needed for workflows that process multiple items.
                                                </p>
                                            </div>

                                            <div class="bg-surface-2 rounded-lg p-4">
                                                <h4 class="font-bold text-ink mb-2 font-mono text-sm">steps</h4>
                                                <p class="text-sm text-ink-muted">
                                                    <strong>Type:</strong> array<br>
                                                    <strong>Required:</strong> Yes (must have at least one step)<br>
                                                    <strong>Purpose:</strong> The main workflow sequence, executed in order.
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Agents Definition -->
                                    <div>
                                        <h3 class="text-2xl font-bold text-ink mb-4">Agents Definition</h3>
                                        <p class="text-ink-muted mb-4">
                                            Agents are specialized roles that execute workflow steps. Each agent has specific capabilities and restrictions.
                                        </p>

                                        <div class="bg-surface-2 rounded-lg overflow-hidden mb-4">
                                            <div class="flex items-center gap-2 px-4 py-2 border-b border-border bg-surface-2">
                                                <span class="text-xs text-ink-faint font-mono">Agent Configuration</span>
                                            </div>
                                            <pre class="p-4 text-sm font-mono text-ink-muted overflow-x-auto"><code><span class="text-purple-400">agents:</span>
  <span class="text-blue-400">orchestrator:</span>
    <span class="text-green-400">description:</span> Plans work and coordinates sub-agents

  <span class="text-blue-400">implementer:</span>
    <span class="text-green-400">description:</span> Writes code to implement features
    </code></pre>
                                        </div>

                                    </div>

                                    <!-- Steps -->
                                    <div>
                                        <h3 class="text-2xl font-bold text-ink mb-4">Steps (Main Workflow Sequence)</h3>
                                        <p class="text-ink-muted mb-4">
                                            Steps define the main workflow sequence. They are executed in order from top to bottom.
                                        </p>

                                        <div class="bg-surface-2 rounded-lg overflow-hidden mb-4">
                                            <div class="flex items-center gap-2 px-4 py-2 border-b border-border bg-surface-2">
                                                <span class="text-xs text-ink-faint font-mono">Main Steps</span>
                                            </div>
                                            <pre class="p-4 text-sm font-mono text-ink-muted overflow-x-auto"><code><span class="text-purple-400">steps:</span>
  - <span class="text-green-400">id:</span> plan
    <span class="text-green-400">type:</span> action
    <span class="text-green-400">agent:</span> orchestrator
    <span class="text-green-400">instructions:</span> |
      Analyze the goal and break it into discrete tasks.

      Consider:
      1. What are the individual features or changes needed?
      2. What are the dependencies between tasks?
      3. What is the optimal order of implementation?

  - <span class="text-green-400">id:</span> define_tasks
    <span class="text-green-400">type:</span> action
    <span class="text-green-400">agent:</span> orchestrator
    <span class="text-green-400">instructions:</span> |
      Call workflow_set_tasks('feature_development', tasks) with:
      - id: unique identifier
      - title: concise title
      - description: detailed description

  - <span class="text-green-400">id:</span> feature_development
    <span class="text-green-400">type:</span> loop
    <span class="text-gray-500"># References the loop defined above</span>

  - <span class="text-green-400">id:</span> final_review
    <span class="text-green-400">type:</span> action
    <span class="text-green-400">agent:</span> reviewer
    <span class="text-green-400">instructions:</span> |
      Review the implementation as a whole...</code></pre>
                                        </div>

                                        <h4 class="text-lg font-semibold text-ink mb-3">Step Fields</h4>
                                        <div class="space-y-3">
                                            <div class="bg-surface-2 rounded-lg p-4">
                                                <h5 class="font-bold text-ink mb-1 font-mono text-sm">id</h5>
                                                <p class="text-sm text-ink-muted">
                                                    <strong>Type:</strong> string<br>
                                                    <strong>Required:</strong> Yes<br>
                                                    Unique identifier for this step. For loop steps, must match a loop name.
                                                </p>
                                            </div>

                                            <div class="bg-surface-2 rounded-lg p-4">
                                                <h5 class="font-bold text-ink mb-1 font-mono text-sm">type</h5>
                                                <p class="text-sm text-ink-muted">
                                                    <strong>Type:</strong> string<br>
                                                    <strong>Required:</strong> Yes<br>
                                                    <strong>Valid values:</strong> action, loop, ralph

                                        <div class="grid md:grid-cols-3 gap-4 mb-4">
                                            <div class="bg-surface-1 border-l-4 border-emerald-500 p-4">
                                                <h5 class="font-bold text-ink mb-2 font-mono text-sm">action</h5>
                                                <p class="text-sm text-ink-muted mb-2">
                                                    A single operation performed by an agent. Used for planning, reviewing, or any one-off task.
                                                </p>
                                                <p class="text-xs text-ink-faint">
                                                    <strong>Required fields:</strong> id, type, instructions<br>
                                                    <strong>Optional fields:</strong> agent
                                                </p>
                                            </div>

                                            <div class="bg-surface-1 border-l-4 border-amber-500 p-4">
                                                <h5 class="font-bold text-ink mb-2 font-mono text-sm">loop</h5>
                                                <p class="text-sm text-ink-muted mb-2">
                                                    Iterates over a list of tasks, executing the loop's sub-steps for each task.
                                                </p>
                                                <p class="text-xs text-ink-faint">
                                                    <strong>Required fields:</strong> id, type<br>
                                                    <strong>Note:</strong> The id must match a loop name defined in the <code class="text-xs bg-surface-2 px-1.5 py-0.5 rounded font-mono">loops:</code> section
                                                </p>
                                            </div>

                                            <div class="bg-surface-1 border-l-4 border-accent p-4">
                                                <h5 class="font-bold text-ink mb-2 font-mono text-sm">ralph</h5>
                                                <p class="text-sm text-ink-muted mb-2">
                                                    Repeats the same task n times for iterative refinement. Claude works on the task multiple times to improve quality.
                                                </p>
                                                <p class="text-xs text-ink-faint">
                                                    <strong>Required fields:</strong> id, type, instructions, n<br>
                                                    <strong>Optional fields:</strong> agent
                                                </p>
                                            </div>
                                        </div>

                                                </p>
                                            </div>

                                            <div class="bg-surface-2 rounded-lg p-4">
                                                <h5 class="font-bold text-ink mb-1 font-mono text-sm">agent</h5>
                                                <p class="text-sm text-ink-muted">
                                                    <strong>Type:</strong> string<br>
                                                    <strong>Required:</strong> No (for action steps)<br>
                                                    <strong>Not applicable:</strong> For loop steps (agents are specified in loop sub-steps)<br>
                                                    Name of the agent to execute this step. When omitted, the main Claude agent handles that step directly instead of delegating to a specialized sub-agent.
                                                This is useful for simpler workflows or steps that don't require specialized capabilities.
                                                </p>
                                            </div>

                                            <div class="bg-surface-2 rounded-lg p-4">
                                                <h5 class="font-bold text-ink mb-1 font-mono text-sm">instructions</h5>
                                                <p class="text-sm text-ink-muted">
                                                    <strong>Type:</strong> string<br>
                                                    <strong>Required:</strong> Yes (for action and ralph steps)<br>
                                                    <strong>Not applicable:</strong> For loop steps (instructions are in loop sub-steps)<br>
                                                    Instructions for what to do in this step.
                                                </p>
                                            </div>

                                            <div class="bg-surface-1 border-l-4 border-accent p-4">
                                                <h5 class="font-bold text-ink mb-1 font-mono text-sm">n</h5>
                                                <p class="text-sm text-ink-muted">
                                                    <strong>Type:</strong> integer<br>
                                                    <strong>Required:</strong> Yes (for ralph steps only)<br>
                                                    <strong>Valid values:</strong> Positive integer (1 or greater)<br>
                                                    Number of times to repeat the step. Each iteration stores its output with a unique key (e.g., <code class="text-xs bg-surface-2 px-1.5 py-0.5 rounded font-mono text-ink-muted">step-id.1</code>, <code class="text-xs bg-surface-2 px-1.5 py-0.5 rounded font-mono text-ink-muted">step-id.2</code>).
                                                </p>
                                            </div>

                                            <div class="bg-surface-1 border-l-4 border-violet-500 p-4">
                                                <h5 class="font-bold text-ink mb-1 font-mono text-sm">on_fail</h5>
                                                <p class="text-sm text-ink-muted">
                                                    <strong>Type:</strong> string<br>
                                                    <strong>Required:</strong> No<br>
                                                    <strong>Valid values:</strong> retry, skip, abort<br>
                                                    <strong>Default:</strong> abort<br>
                                                    Action to take if this step fails.
                                                </p>
                                            </div>

                                            <div class="bg-surface-1 border-l-4 border-emerald-500 p-4">
                                                <h5 class="font-bold text-ink mb-1 font-mono text-sm">context</h5>
                                                <p class="text-sm text-ink-muted">
                                                    <strong>Type:</strong> string<br>
                                                    <strong>Required:</strong> No<br>
                                                    <strong>Valid values:</strong> clear<br>
                                                    <strong>Default:</strong> (no change)<br>
                                                    When set to <code class="text-xs bg-surface-2 px-1.5 py-0.5 rounded font-mono text-ink-muted">clear</code>, Lanes will clear the Claude session context when this step begins. This gives the orchestrator a fresh context window for larger development loops. Use this only if you are confident your workflow saves plans in artefacts that can be reloaded.
                                                </p>
                                            </div>

                                            <div class="bg-surface-1 border-l-4 border-amber-500 p-4">
                                                <h5 class="font-bold text-ink mb-1 font-mono text-sm">artefacts</h5>
                                                <p class="text-sm text-ink-muted">
                                                    <strong>Type:</strong> boolean<br>
                                                    <strong>Required:</strong> No<br>
                                                    <strong>Valid values:</strong> true, false<br>
                                                    <strong>Default:</strong> false<br>
                                                    When set to <code class="text-xs bg-surface-2 px-1.5 py-0.5 rounded font-mono text-ink-muted">true</code>, Lanes introduces a hook that tracks all files created during this step. Downstream steps are made aware of these artefacts and can read them to gain context. This is especially useful when combined with <code class="text-xs bg-surface-2 px-1.5 py-0.5 rounded font-mono text-ink-muted">context: clear</code> to preserve important work across context resets.
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Loops and Sub-steps -->
                                    <div>
                                        <h3 class="text-2xl font-bold text-ink mb-4">Loops and Sub-steps</h3>
                                        <p class="text-ink-muted mb-4">
                                            Loops are reusable sub-workflows that execute a sequence of steps for each task in a list.
                                            They enable structured iteration over features, fixes, or refactors.
                                        </p>

                                        <div class="bg-surface-2 rounded-lg overflow-hidden mb-4">
                                            <div class="flex items-center gap-2 px-4 py-2 border-b border-border bg-surface-2">
                                                <span class="text-xs text-ink-faint font-mono">Loop Definition</span>
                                            </div>
                                            <pre class="p-4 text-sm font-mono text-ink-muted overflow-x-auto"><code><span class="text-purple-400">loops:</span>
  <span class="text-blue-400">feature_development:</span>
    - <span class="text-green-400">id:</span> implement
      <span class="text-green-400">agent:</span> implementer
      <span class="text-green-400">instructions:</span> |
        Implement: {task.title}

        1. Read relevant files to understand context
        2. Plan the implementation approach
        3. Write the code
        4. Verify it compiles

    - <span class="text-green-400">id:</span> test
      <span class="text-green-400">agent:</span> tester
      <span class="text-green-400">instructions:</span> |
        Run tests for: {task.title}

        1. Run the existing test suite
        2. Identify any failing tests
        3. Fix any test failures
        4. Ensure all tests pass
      <span class="text-green-400">on_fail:</span> retry

    - <span class="text-green-400">id:</span> review
      <span class="text-green-400">agent:</span> reviewer
      <span class="text-green-400">instructions:</span> |
        Review implementation of: {task.title}

        Check for:
        1. Security vulnerabilities
        2. Proper error handling
        3. Code quality and patterns

    - <span class="text-green-400">id:</span> resolution
      <span class="text-green-400">instructions:</span> |
        <span class="text-gray-500"># No agent specified - main Claude handles this</span>
        Address any issues from the review of: {task.title}</code></pre>
                                        </div>

                                    </div>

                                    <!-- Task Variables -->
                                    <div>
                                        <h3 class="text-2xl font-bold text-ink mb-4">Task Variables</h3>
                                        <p class="text-ink-muted mb-4">
                                            Within loop sub-step instructions, you can reference task properties using curly brace syntax:
                                        </p>

                                        <div class="grid md:grid-cols-3 gap-4 mb-4">
                                            <div class="bg-surface-1 border border-border rounded-lg p-4">
                                                <h5 class="font-bold text-ink mb-2 font-mono text-sm">{task.id}</h5>
                                                <p class="text-sm text-ink-muted">
                                                    The unique identifier for the current task (e.g., "add-login-form").
                                                </p>
                                            </div>

                                            <div class="bg-surface-1 border border-border rounded-lg p-4">
                                                <h5 class="font-bold text-ink mb-2 font-mono text-sm">{task.title}</h5>
                                                <p class="text-sm text-ink-muted">
                                                    The concise title of the current task (e.g., "Login form UI").
                                                </p>
                                            </div>

                                        </div>

                                        <div class="bg-surface-2 rounded-lg overflow-hidden">
                                            <div class="flex items-center gap-2 px-4 py-2 border-b border-border bg-surface-2">
                                                <span class="text-xs text-ink-faint font-mono">Example: Using Task Variables</span>
                                            </div>
                                            <pre class="p-4 text-sm font-mono text-ink-muted overflow-x-auto"><code><span class="text-green-400">instructions:</span> |
  Implement: {task.title}

  Task ID for reference: {task.id}

  1. Read relevant files
  2. Implement the feature
  3. Verify it works</code></pre>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </section>
